<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacy Management System - Suppliers</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            background-color: #1e1e2f;
            color: #e0e0e0;
        }
        .sidebar {
            width: 250px;
            background-color: #2b2b3c;
            color: #e0e0e0;
        }
        .sidebar h2 {
            text-align: center;
            padding: 20px 0;
            color: #20c997;
        }
        .sidebar .nav-link {
            color: #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sidebar .nav-link:hover {
            background-color: #3a3a4d;
        }
        .sidebar .nav-link.active {
            background-color: #495057;
        }
        .content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #282838;
        }
        .tab-pane {
            padding: 20px;
            border: 1px solid #3a3a4d;
            background-color: #2b2b3c;
            border-radius: 5px;
        }
        .btn-signup {
            background-color: #20c997;
            color: white;
        }
        .btn-signup:hover {
            background-color: #17a589;
        }
        .form-control {
            background-color: #1e1e2f;
            color: #e0e0e0;
            border: 1px solid #495057;
        }
        .form-control:focus {
            background-color: #1e1e2f;
            color: #fff;
            border-color: #20c997;
            box-shadow: 0 0 0 0.2rem rgba(32, 201, 151, 0.25);
        }
        .form-check-input {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .nav-tabs .nav-link {
            color: #e0e0e0;
        }
        .nav-tabs .nav-link.active {
            background-color: #3a3a4d;
            color: #20c997;
            border-color: #495057 #495057 #282838;
        }
        header h1 {
            color: #20c997;
        }
        header .btn {
            background-color: #495057;
            color: #e0e0e0;
        }
        header .btn:hover {
            background-color: #3a3a4d;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <h2>PharmaCare</h2>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a href="/dashboard" class="nav-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            </li>
            <li class="nav-item">
                <a href="/doctor-orders" class="nav-link"><i class="fas fa-file-medical"></i> Doctor Orders</a>
            </li>
            <li class="nav-item">
                <a href="/medicaments" class="nav-link"><i class="fas fa-cash-register"></i> PoS</a>
            </li>
            <li class="nav-item">
                <a href="/suppliers" class="nav-link active"><i class="fas fa-truck"></i> Suppliers</a>
            </li>
            <li class="nav-item">
                <a href="/users" class="nav-link"><i class="fas fa-user-alt"></i> Users</a>
            </li>
            <li class="nav-item">
                <a href="/logout" class="nav-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </li>
        </ul>
    </nav>

    <!-- Content -->
    <div class="content">
        <header class="d-flex justify-content-between align-items-center mb-4">
            <h1>Suppliers</h1>
        </header>

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="add-supplier-tab" data-bs-toggle="tab" data-bs-target="#add-supplier" type="button" role="tab" aria-controls="add-supplier" aria-selected="true">Add New Supplier</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="manage-supplier-tab" data-bs-toggle="tab" data-bs-target="#manage-supplier" type="button" role="tab" aria-controls="manage-supplier" aria-selected="false">Manage Suppliers</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Add Supplier -->
            <div class="tab-pane fade show active" id="add-supplier" role="tabpanel" aria-labelledby="add-supplier-tab">
                <h3>Add New Supplier</h3>
                <form id="addSupplierForm">
                    <div class="mb-3">
                        <label for="supplierName" class="form-label">Supplier Name</label>
                        <input type="text" class="form-control" id="supplierName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="supplierContact" class="form-label">Contact Number</label>
                        <input type="tel" class="form-control" id="supplierContact" name="contact" pattern="[0-9]{10}" required>
                    </div>
                    <div class="mb-3">
                        <label for="supplierEmail" class="form-label">Supplier Email</label>
                        <input type="email" class="form-control" id="supplierEmail" name="email" required>
                    </div>
        
                    <button type="submit" class="btn btn-signup">Add Supplier</button>
                </form>
            </div>

            <!-- Manage Suppliers -->
            <div class="tab-pane fade" id="manage-supplier" role="tabpanel" aria-labelledby="manage-supplier-tab">
                <h3>Manage Suppliers</h3>
                <!-- Search bar -->
                <div class="mb-3">
                    <input type="text" id="searchSupplier" class="form-control" placeholder="Search for a supplier by name or email">
                </div>

                <!-- Suppliers table -->
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Contact</th>
                            <th>Email</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="supplierTableBody">
                        <!-- Rows will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editSupplierModal" tabindex="-1" aria-labelledby="editSupplierModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="editSupplierForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="editSupplierModalLabel">Edit Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editSupplierId" />

                    <div class="mb-3">
                        <label for="editSupplierName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="editSupplierName" required />
                    </div>

                    <div class="mb-3">
                        <label for="editSupplierContact" class="form-label">Contact</label>
                        <input type="text" class="form-control" id="editSupplierContact" required />
                    </div>

                    <div class="mb-3">
                        <label for="editSupplierEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editSupplierEmail" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>


    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>



<script>

  document.addEventListener('DOMContentLoaded', () => {
    // Récupérer les fournisseurs à l'affichage de la page
    fetchSuppliers();

    // Recherche dynamique
    document.getElementById('searchSupplier').addEventListener('input', function () {
        const query = this.value.toLowerCase();
        const rows = document.querySelectorAll('#supplierTableBody tr');
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(query) ? '' : 'none';
        });
    });

    // Formulaire d'ajout de fournisseur
    document.getElementById('addSupplierForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const supplier = {
            nom: document.getElementById('supplierName').value,
            contact: document.getElementById('supplierContact').value,
            email: document.getElementById('supplierEmail').value
        };

        fetch('/add-supplier', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(supplier)
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Fournisseur ajouté avec succès');
                    fetchSuppliers(); // Actualiser la table (à définir ailleurs)
                    document.getElementById('addSupplierForm').reset(); // Réinitialiser le formulaire
                } else {
                    alert('Erreur : ' + data.message);
                }
            })
            .catch(err => console.error('Erreur lors de l\'ajout :', err));
    });
});

// Fonction pour récupérer et afficher les fournisseurs
function fetchSuppliers() {
    fetch('/manage-suppliers')
        .then(res => res.json())
        .then(data => {
            const tableBody = document.getElementById('supplierTableBody');
            tableBody.innerHTML = ''; // Vider le tableau
            data.forEach((supplier, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${supplier.nom}</td>
                    <td>${supplier.contact}</td>
                    <td>${supplier.email}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editSupplier(${supplier.id_fournisseur})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteSupplier(${supplier.id_fournisseur})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        })
        .catch(err => console.error('Erreur lors de la récupération des fournisseurs :', err));
}

// Fonction pour supprimer un fournisseur
function deleteSupplier(id) {
    if (confirm('Êtes-vous sûr de vouloir supprimer ce fournisseur ?')) {
        fetch(`/delete-supplier/${id}`, { method: 'DELETE' })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                fetchSuppliers(); // Actualiser la table
            })
            .catch(err => console.error('Erreur lors de la suppression :', err));
    }
}

// Fonction pour ouvrir le modal de modification et pré-remplir les champs
function editSupplier(id) {
    // Récupérer les données du fournisseur via l'API
    fetch(`/suppliers/${id}`)
        .then(res => res.json())
        .then(data => {
            // Pré-remplir le formulaire modal
            document.getElementById('editSupplierId').value = data.id_fournisseur;
            document.getElementById('editSupplierName').value = data.nom;
            document.getElementById('editSupplierContact').value = data.contact;
            document.getElementById('editSupplierEmail').value = data.email;

            // Afficher le modal
            const editModal = new bootstrap.Modal(document.getElementById('editSupplierModal'));
            editModal.show();
        })
        .catch(err => console.error('Erreur lors de la récupération des données du fournisseur :', err));
}

// Soumettre les modifications du fournisseur
document.getElementById('editSupplierForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const supplierId = document.getElementById('editSupplierId').value;
    const updatedData = {
        nom: document.getElementById('editSupplierName').value,
        contact: document.getElementById('editSupplierContact').value,
        email: document.getElementById('editSupplierEmail').value
    };

    fetch(`/suppliers/${supplierId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(updatedData)
    })
        .then(res => res.json())
        .then(response => {
            if (response.message === 'Fournisseur modifié avec succès') {
                alert('Fournisseur mis à jour avec succès !');
                location.reload(); // Recharger la liste des fournisseurs après modification
            } else {
                alert('Échec de la mise à jour du fournisseur. Veuillez réessayer.');
            }
        })
        .catch(err => console.error('Erreur lors de la mise à jour du fournisseur :', err));
});



</script>
